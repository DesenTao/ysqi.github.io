<!DOCTYPE html><html xmlns="https://www.w3.org/1999/xhtml" xmlns:og="https://ogp.me/ns#" lang="zh" id="doc" class="no-js"><head><title>介绍GDB调试Go |虞双齐Golang开发与SRE运维</title><meta name="description" content="注：本文作者是 YANN，原文是 Introduction to Go Debugging with"><meta name="keywords" content="gdb, debug, golang, "><meta name="author" content="虞双齐"><meta name="generator" content="Hugo 0.17"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="renderer" content="webkit"><meta name="applicable-device" content="pc,mobile"><meta name="MobileOptimized" content="width"><meta name="HandheldFriendly" content="true"><meta name="mobile-web-app-capable" content="yes"><link rel="icon" sizes="192x192" href="/img/app-icon64x64@2x.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="apple-mobile-web-app-title" content="Ysqi"><link rel="apple-touch-icon-precomposed" href="/img/app-icon64x64@2x.png"><meta name="msapplication-TileImage" content="/img/app-icon64x64@2x.png"><meta name="msapplication-TileColor" content="#0e90d2"><meta property="og:site_name" content="虞双齐Golang开发与SRE运维"><meta property="og:locale" content="zh"><meta property="og:url" content="https://yushuangqi.com/blog/2016/jie-shao--gdb-diao-shi--go.html"><meta property="og:title" content="介绍GDB调试Go"><meta property="og:type" content="article"><meta property="article:published_time" content="2016-12-31 11:34:43"><meta property="article:modified_time" content="2016-12-31 11:34:43"><meta property="article:tag" content="gdb"><meta property="article:tag" content="debug"><meta property="article:tag" content="golang"><meta name="og:description" content="注：本文作者是 YANN，原文是 Introduction to Go Debugging with"><link rel="stylesheet" type="text/css" href="/css/jiandan.css?v=20170207"><script type="text/javascript">var doc = document.getElementById('doc');
	doc.removeAttribute('class', 'no-js');
	doc.setAttribute('class', 'js');</script><script type="text/javascript">var changeActive = function() {
		var page = document.getElementById("page");		
		if (page.getAttribute("class") === "not-active") {
			page.setAttribute("class", "active-sidebar");		
		} else if (page.getAttribute("class") === "active-sidebar") {
			page.setAttribute("class", "not-active");
		}		
	}
	
	window.onload = function() {
		if(document.getElementById("sidebar-button")) {
			var sidebar_button = document.getElementById("sidebar-button");
			sidebar_button.onclick = function(event) {
				changeActive();
				event.preventDefault();
			}
		}
		
	}
	
	window.onresize = function() {
		var page = document.getElementById("page");	
		page.setAttribute("class", "not-active");	
	}</script></head><body id="page" class="not-active"><div class="container"><header class="header writingsheader"><nav class="off-canvas-nav-links"><ul><li class="menuli"><a class="menubutton" href="#menu">Menu</a></li><li id="site-title"><a class="menulogo" id="sidebar-button" href="#sidebar">附件信息</a></li></ul></nav></header><section role="main"><article class="entry writingsentry" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 itemprop="headline"><a rel="bookmark" href="https://yushuangqi.com/blog/2016/jie-shao--gdb-diao-shi--go.html">介绍GDB调试Go</a></h1><p class="attribution"><span itemprop="author"><span itemscope itemtype="http://schema.org/Person">文/ <a href="https://segmentfault.com/a/1190000000664422" rel="nofollow" target="_blank">属转载,查看原文 <span itemprop="name" style="display:none">虞双齐</span></a></span> </span><span class="right"><time itemprop="datePublished" datetime="2016-12-31">2016年12月31日</time></span></p></header><div itemprop="articleBody"><blockquote><p>注：本文作者是 <a href="http://lincolnloop.com/blog/by-author/yml/">YANN</a>，原文是 <a href="http://lincolnloop.com/blog/introduction-go-debugging-gdb/">Introduction to Go Debugging with GDB</a></p></blockquote><p>在过去的 4 年中，我花了我绝大部分的时间用来写，读以及调试 Python 或 JavaScript 代码。在学习 Go 的过程中，像穿着一双有小石子的鞋子在美丽的山中远行。很多事情给我留下了深刻的印象，但是使用 <code>println</code> 调试我的代码在过去走的太远了。在 Python 中，当代码在运行的时候，我们使用 <code>pdb/ipdb</code> 调试它，JavaScript 提供了类似的工具。在这些年中，这个模式已经变成了我工作流中非常重要的一部分了。</p><p>今天，我认识到 Go 已经内建支持 <a href="http://sourceware.org/gdb/current/onlinedocs/gdb/">Gnu debugger (aka GDB)</a>。</p><p>为了这篇文章，我们使用以下这个简单的程序：</p><div class="highlight" style="background:#f0f0f0"><pre style="line-height:125%"><span></span>    <span style="color:#007020;font-weight:700">package</span> main

    <span style="color:#007020;font-weight:700">import</span> (
        <span style="color:#4070a0">&quot;fmt&quot;</span>
        <span style="color:#4070a0">&quot;time&quot;</span>
    )

    <span style="color:#007020;font-weight:700">func</span> counting(c <span style="color:#007020;font-weight:700">chan</span><span style="color:#666">&lt;-</span> <span style="color:#902000">int</span>) {
        <span style="color:#007020;font-weight:700">for</span> i <span style="color:#666">:=</span> <span style="color:#40a070">0</span>; i &lt; <span style="color:#40a070">10</span>; i<span style="color:#666">++</span> {
            time.Sleep(<span style="color:#40a070">2</span> <span style="color:#666">*</span> time.Second)
            c <span style="color:#666">&lt;-</span> i
        }
        <span style="color:#007020">close</span>(c)
    }

    <span style="color:#007020;font-weight:700">func</span> main() {
        msg <span style="color:#666">:=</span> <span style="color:#4070a0">&quot;Starting main&quot;</span>
        fmt.Println(msg)
        bus <span style="color:#666">:=</span> <span style="color:#007020">make</span>(<span style="color:#007020;font-weight:700">chan</span> <span style="color:#902000">int</span>)
        msg = <span style="color:#4070a0">&quot;starting a gofunc&quot;</span>
        <span style="color:#007020;font-weight:700">go</span> counting(bus)
        <span style="color:#007020;font-weight:700">for</span> count <span style="color:#666">:=</span> <span style="color:#007020;font-weight:700">range</span> bus {
            fmt.Println(<span style="color:#4070a0">&quot;count:&quot;</span>, count)
        }
    }
</pre></div><p>为了使用 GDB，你需要使用 <code>-gcflags ”-N -l”</code> 选项编译你的程序，这些选项阻止编译器使用内联函数和变量。</p><div class="highlight" style="background:#f0f0f0"><pre style="line-height:125%"><span></span>    <span style="color:#007020;font-weight:700">go</span> build <span style="color:#666">-</span>gcflags <span style="color:#4070a0">&quot;-N -l&quot;</span> gdbsandbox.<span style="color:#007020;font-weight:700">go</span>
</pre></div><p>这是一个交互式的调试 GDB 的会话示例：</p><pre><code>yml@simba$  gdb gdbsandbox 
GNU gdb (Ubuntu/Linaro 7.4-2012.04-0ubuntu2) 7.4-2012.04
Copyright (C) 2012 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;
</code></pre><p>首先，我们运行我们的程序：</p><pre><code>(gdb) run
Starting program: /home/yml/Developments/go/src/gdbsandbox/gdbsandbox 
Starting main
count: 0
count: 1
count: 2
[...]
count: 9
[Inferior 1 (process 13507) exited normally]
</code></pre><p>现在我们知道怎样运行我们的程序，我们可能想设置一个断点。</p><pre><code>(gdb) help break 
Set breakpoint at specified line or function.
break [LOCATION] [thread THREADNUM] [if CONDITION]
LOCATION may be a line number, function name, or &quot;*&quot; and an address.
[...]
(gdb) break 22
Breakpoint 1 at 0x400d7a: file /home/yml/Developments/go/src/gdbsandbox/gdbsandbox.go, line 22.
(gdb) run
Starting program: /home/yml/Developments/go/src/gdbsandbox/gdbsandbox 
Starting main
[New LWP 13672]
[Switching to LWP 13672]
Breakpoint 1, main.main () at /home/yml/Developments/go/src/gdbsandbox/gdbsandbox.go:22
22              for count := range bus {
(gdb) 
</code></pre><p>一旦 GDB 在你的断点处停止，你将看到上下文：</p><pre><code>(gdb) help list
List specified function or line.
With no argument, lists ten more lines after or around previous listing.
&quot;list -&quot; lists the ten lines before a previous ten-line listing.
[...]
(gdb) list
17              msg := &quot;Starting main&quot;
18              fmt.Println(msg)
19              bus := make(chan int)
20              msg = &quot;starting a gofunc&quot;
21              go counting(bus)
22              for count := range bus {
23                      fmt.Println(&quot;count:&quot;, count)
24              }
25      }
</code></pre><p>你也可以检查变量：</p><pre><code>(gdb) help print
Print value of expression EXP.
Variables accessible are those of the lexical environment of the selected
stack frame, plus all those whose scope is global or an entire file.
[...]
(gdb) print msg
$1 = &quot;starting a gofunc&quot;
</code></pre><p>在代码的早期，我们启动了一个 <code>goroutine</code>，当我执行到第 10 行的时候，我想查看我程序中的这部分。</p><pre><code>(gdb) break 10
Breakpoint 3 at 0x400c28: file /home/yml/Developments/go/src/gdbsandbox/gdbsandbox.go, line 10.
(gdb) help continue
Continue program being debugged, after signal or breakpoint.
If proceeding from breakpoint, a number N may be used as an argument,
which means to set the ignore count of that breakpoint to N - 1 (so that
the breakpoint won't break until the Nth time it is reached).
[...]
(gdb) continue
Continuing.
</code></pre><p>在今天我们要做的最后一件事情就是在运行期改变一个变量的值：</p><pre><code>Breakpoint 3, main.counting (c=0xf840001a50) at /home/yml/Developments/go/src/gdbsandbox/gdbsandbox.go:10
10                      time.Sleep(2 * time.Second)
(gdb) help whatis
Print data type of expression EXP.
Only one level of typedefs is unrolled.  See also &quot;ptype&quot;.
(gdb) whatis count
type = int
(gdb) print count
$3 = 1
(gdb) set variable count=3
(gdb) print count
$4 = 3
(gdb) c
Continuing.
count: 3
</code></pre><p>我们仅仅覆盖了以下命令：</p><ul><li>list</li><li>next</li><li>print</li><li>continue</li><li>break</li><li>whatis</li><li>set variable =</li></ul><p>这几乎只是涉及到了使用 GDB 的表面知识，如果你想学习关于 GDB 更多的知识，这里有更多的链接：</p><ul><li><a href="http://sourceware.org/gdb/current/onlinedocs/gdb/">http://sourceware.org/gdb/current/onlinedocs/gdb/</a></li><li><a href="http://golang.org/doc/gdb">http://golang.org/doc/gdb</a></li></ul></div><aside id="meta"><meta itemprop="wordCount" content="481"><meta itemprop="url" content="https://yushuangqi.com/blog/2016/jie-shao--gdb-diao-shi--go.html"></aside></article><div><div class="attribution"><div class="bdsharebuttonbox"><a href="#" class="bds_more" data-cmd="more"></a><a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a><a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a><a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a><a href="#" class="bds_youdao" data-cmd="youdao" title="分享到有道云笔记"></a><a href="#" class="bds_mshare" data-cmd="mshare" title="分享到一键分享"></a></div><script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":["mshare","qzone","tsina","bdysc","weixin","tqq","tieba","douban","sqq","youdao","qingbiji","mail","evernotecn","copy","print"],"bdPic":"","bdStyle":"0","bdSize":"32"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script></div><div><ul class="rel_links"><li class="rel_linksli"><span id="topics">分类: <a href="/topics/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E4%B8%8E%E5%BC%80%E5%8F%91.html" rel="category">编程语言与开发</a> </span><span id="tags">标签: <a href="/tags/debug.html" rel="tag">debug</a> <a href="/tags/gdb.html" rel="tag">gdb</a> <a href="/tags/golang.html" rel="tag">golang</a></span></li><li class="rel_linksli rel_prev"><a href="https://yushuangqi.com/blog/2016/golangshi-xian-kuai-su-pai-xu.html">golang实现快速排序</a></li><li class="rel_linksli rel_next"><a href="https://yushuangqi.com/blog/2016/golang-read-file-line-by-line.html">GolangReadFilelinebyline</a></li></ul></div><aside id="comments"><div><div class="ds-thread" data-thread-key="8ece58342032c7b8dd7f5fd282fe8972" data-title="介绍GDB调试Go" data-url="https://yushuangqi.com/blog/2016/jie-shao--gdb-diao-shi--go.html"></div></div></aside><div><section id="author"><h4>About author</h4><p><strong>虞双齐</strong>，全栈开发工程师，Google SRE实践者。提供Golang开发、技术实践与架构等咨询服务。</p><p>动态分享到微博<a href="http://weibo.com/234665601" rel="nofollow">@虞双齐</a>，代码存放在 <a href="http://github.com/ysqi" rel="nofollow">Github</a>，博文分享在 <a href="https://yushuangqi.com" title="虞双齐Golang开发与SRE运维">个人博客</a>上。</p></section></div></div></section><section id="sidebar" role="complementary"><aside class="writings"><a href="/" class="sideimg sideimgwritings">Home</a> <q class="dquote">读书之法，莫贵于循序而致精。<cite>—宋·朱熹《性理精义》</cite></q><ul class="rel_links"><li class="rel_linksli"><a href="http://weibo.com/234665601" title="关注虞双齐的微博" rel="nofollow">我的微博</a></li><li class="rel_linksli"><a href="https://github.com/ysqi" title="访问虞双齐的Github" rel="nofollow">我的 Github</a></li></ul></aside><aside><div class="ds-recent-comments" data-num-items="5" data-show-avatars="1" data-show-time="1" data-show-title="1" data-show-admin="1" data-excerpt-length="70"></div></aside></section><nav id="menu" role="navigation"><ul id="nav" class="navlist"><li class="navtop"><a class="navtoplink" href="#page"><span>Top</span></a></li><li><a class="navabout" href="https://yushuangqi.com"><span>首页</span></a></li><li><a class="navwritings" href="/topics/"><span>博文</span></a></li><li><a class="navpresos" href="/book.html"><span>电子书</span></a></li><li><a class="navabout" href="/about.html"><span>关于我</span></a></li></ul></nav></div><footer class="site-footer"><ul class="footeractions"><li><a class="footeraction" href="http://weibo.com/234665601" rel="nofollow"><span class="footeractionWeibo">Follow on Weibo</span></a></li><li><a href="http://validator.w3.org/check?uri=https%3a%2f%2fyushuangqi.com%2fblog%2f2016%2fjie-shao--gdb-diao-shi--go.html" rel="nofollow" target="blank"><img src="https://static.yushuangqi.com//assets/valid-html401.png" alt="Valid XHTMl 4.0"></a></li><li><a href="http://jigsaw.w3.org/css-validator/validator?uri=https%3a%2f%2fyushuangqi.com%2fblog%2f2016%2fjie-shao--gdb-diao-shi--go.html" rel="nofollow" target="blank"><img src="https://static.yushuangqi.com//assets/valid-css2.png" alt="Valid XHTMl 4.0"></a></li></ul><p>©2015-2016 虞双齐-#Golang开发 #SRE运维。欢迎<a href="/about.html" rel="nofollow">联系我</a>，<a href="http://www.miitbeian.gov.cn/" target="bank" rel="nofollow" style="color:#c9c9c9">粤ICP备14032560号-4</a></p></footer><script type="text/javascript">var duoshuoQuery = {short_name:"ysqi"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();</script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-44627932-2', 'auto');
  ga('send', 'pageview');</script></body></html>