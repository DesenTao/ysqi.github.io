<!DOCTYPE html><html xmlns="https://www.w3.org/1999/xhtml" xmlns:og="https://ogp.me/ns#" lang="zh" id="doc" class="no-js"><head><title>Go最新的dep详解 |虞双齐的博客</title><meta name="description" content="该文翻译自https://medium.com/i-can-haz-downtime/dep-101"><meta name="keywords" content="golang, "><meta name="author" content="虞双齐"><meta name="generator" content="Hugo 0.17"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="renderer" content="webkit"><meta name="applicable-device" content="pc,mobile"><meta name="MobileOptimized" content="width"><meta name="HandheldFriendly" content="true"><meta name="mobile-web-app-capable" content="yes"><link rel="icon" sizes="32x32" href="/img/favicon.ico"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="apple-mobile-web-app-title" content="虞双齐"><link rel="apple-touch-icon-precomposed" href="/img/app-icon64x64.png"><meta name="msapplication-TileImage" content="/img/app-icon128x128.png"><meta name="msapplication-TileColor" content="#0e90d2"><meta property="og:site_name" content="虞双齐的博客"><meta property="og:locale" content="zh"><meta property="og:url" content="https://yushuangqi.com/blog/2017/gozui-xin-de-depxiang-jie.html"><meta property="og:title" content="Go最新的dep详解"><meta property="og:type" content="article"><meta property="article:published_time" content="2017-02-18 11:13:41"><meta property="article:modified_time" content="2017-02-18 11:13:41"><meta property="article:tag" content="golang"><meta name="og:description" content="该文翻译自https://medium.com/i-can-haz-downtime/dep-101"><link rel="stylesheet" type="text/css" href="/css/jiandan.css?v=201708"><script type="text/javascript">var doc = document.getElementById('doc');
	doc.removeAttribute('class', 'no-js');
	doc.setAttribute('class', 'js');</script><script type="text/javascript">var changeActive = function() {
		var page = document.getElementById("page");		
		if (page.getAttribute("class") === "not-active") {
			page.setAttribute("class", "active-sidebar");		
		} else if (page.getAttribute("class") === "active-sidebar") {
			page.setAttribute("class", "not-active");
		}		
	}
	
	window.onload = function() {
		if(document.getElementById("sidebar-button")) {
			var sidebar_button = document.getElementById("sidebar-button");
			sidebar_button.onclick = function(event) {
				changeActive();
				event.preventDefault();
			}
		}
		
	}
	
	window.onresize = function() {
		var page = document.getElementById("page");	
		page.setAttribute("class", "not-active");	
	}</script></head><body id="page" class="not-active"><div class="container"><header class="header writingsheader"><nav class="off-canvas-nav-links"><ul><li class="menuli"><a class="menubutton" href="#menu">Menu</a></li><li id="site-title"><a class="menulogo" id="sidebar-button" href="#sidebar">附件信息</a></li></ul></nav></header><section role="main"><article class="entry writingsentry" itemscope itemtype="http://schema.org/BlogPosting"><header><h1 itemprop="headline"><a rel="bookmark" href="https://yushuangqi.com/blog/2017/gozui-xin-de-depxiang-jie.html">Go最新的dep详解</a></h1><p class="attribution"><span itemprop="author"><span itemscope itemtype="http://schema.org/Person">文/ <a href="https://mp.weixin.qq.com/s?__biz=MjM5OTcxMzE0MQ==&amp;amp;mid=2653369860&amp;amp;idx=1&amp;amp;sn=0e3b9ab8346e69087bb2050b28b34d9f&amp;amp;chksm=bce4d61e8b935f0817f34510225ababb71491b5a5614c2b6ec105a3f103347fbb7cccabf57e8&amp;amp;mpshare=1&amp;amp;scene=1&amp;amp;srcid=0214qm8bmviC4MFY2xKkygJG&amp;amp;key=81e78a55b343" rel="nofollow" target="_blank">属转载,查看原文 <span itemprop="name" style="display:none">虞双齐</span></a></span> </span><span class="right"><time itemprop="datePublished" datetime="2017-02-18">2017年02月18日</time></span></p></header><div itemprop="articleBody"><p>该文翻译自<a href="https://medium.com/i-can-haz-downtime/dep-101-c85e8ab6ed45#.hbngswi0e">https://medium.com/i-can-haz-downtime/dep-101-c85e8ab6ed45#.hbngswi0e</a></p><p>我很高兴在过去几个月和几个其他gopher开发的一个原型依赖管理工具，名为dep。</p><p>dep是去年开始由Peter Bourgon组织的项目的一部分。由于我参与开发了一个“godep”，Go的OG依赖管理工具（继承自Keith Rarick），因此加入了dep项目的团队。</p><p>除了我自己和Peter，团队的其他成员是Jessie Frazelle，Andrew Gerrand和Sam Boyer。 Andrew是Google Go team的一员。 Jessie在Google工作，并参与过大型Go项目，如Docker和Kubernetes。 Sam维护gps。</p><p>该团队发布了一系列我们工作过程中的进展信息。到目前为止，各种其他工具作者和相关方也以不同的方式参与这一项目。</p><h2 id="起初">起初</h2><p>假设我们正在使用github.com/gorilla/mux编写一个Web应用程序。 这里是一些代码，让我们开始：</p><pre><code>package main

import (
    &quot;net/http&quot;
    &quot;os&quot;

    &quot;github.com/gorilla/mux&quot;
)

func main() {
    r := mux.NewRouter()
    r.Handle(&quot;/&quot;, http.FileServer(http.Dir(&quot;.&quot;)))
    http.ListenAndServe(&quot;:&quot;+os.Getenv(&quot;PORT&quot;), r)
}
</code></pre><p>在现有项目上第一次使用dep时，需要运行dep init。</p><p>dep init将在GOPATH中已经包含github.com/gorilla/mux，manifest.json文件将包括它。我先运行如下命令：</p><pre><code>go get -u github.com/gorilla/mux
</code></pre><p>所以在我的\$GOPATH中github.com/gorilla/mux的分支是master。如果我的\$GOPATH中的版本匹配Semver tag（例如：v1.2.3），那么将使用该tag的名称。</p><p>dep可以跨越架构和go版本。我们可以将github.com/gorilla/mux与旧版本的Go（&lt;1.7.0）的github.com/gorilla/context包结合使用。当我最后运行</p><pre><code>go get -u github.com/gorilla/mux
</code></pre><p>的时候，我运行的是Go 1.7.5，所以github.com/gorilla/context包不在我的\$GOPATH。因为可能是编译项目所需的依赖，它会包含在lock.json文件中。在这种场景下，如果从属项目有一个semver兼容的release tag，dep会选择最新的版本。在这种情况下是github.com/gorilla/context的v1.1。</p><p>因为github.com/gorilla/mux不包含manifest.json文件，dep不知道github.com/gorilla/mux目前是否能与github.com/gorilla/context@v1.1配合使用。dep一般使用在依赖的manifest.json文件中找到的约束。</p><p>dep init包括所有依赖关系（包括递归依赖）以及在lock.json文件中使用的确切版本。</p><p>对于示例应用程序，这将创建以下两个文件：<br>lock.json</p><pre><code>{
    &quot;memo&quot;: &quot;d741a3bed21fe6cae9d67c523b0a343859882b2f246f2a293e2676cfacd5a2ce&quot;,
    &quot;projects&quot;: [
        {
            &quot;name&quot;: &quot;github.com/gorilla/context&quot;,
            &quot;version&quot;: &quot;v1.1&quot;,
            &quot;revision&quot;: &quot;a85d2e53ba63bdea074dbbbb5983f0516974e87b&quot;,
            &quot;packages&quot;: [
                &quot;.&quot;
            ]
        },
        {
            &quot;name&quot;: &quot;github.com/gorilla/mux&quot;,
            &quot;branch&quot;: &quot;master&quot;,
            &quot;revision&quot;: &quot;392c28fe23e1c45ddba891b0320b3b5df220beea&quot;,
            &quot;packages&quot;: [
                &quot;.&quot;
            ]
        }
    ]
}
</code></pre><p>manifest.json</p><pre><code>{
    &quot;dependencies&quot;: {
        &quot;github.com/gorilla/mux&quot;: {
            &quot;branch&quot;: &quot;master&quot;
        }
    }
}
</code></pre><h2 id="确保项目可以编译">确保项目可以编译</h2><p>在运行dep init之后，应该运行dep ensure以便将构建项目所需的软件包副本填充在vendor/目录。 这确保任何项目的依赖项都包括在lock文件和vendor目录中。 如果你想确保记录所有的依赖，运行dep ensure。</p><h2 id="添加依赖">添加依赖</h2><p>添加另一个依赖项，只需在代码中使用它。 当需要检查你的工作时，你需要运行dep ensure更新lock.json文件和vendor/。 这将锁定项目到每个依赖项的最新发布版本。</p><h2 id="如果最新版本不合适呢">如果最新版本不合适呢？</h2><p>如果需要指定版本，可以使用ensure命令的备用形式，如：dep ensure github.com/gorilla/mux@\\^1.3.0。该命令修改manifest.json文件，约束dep使用github.com/gorilla/mux的\\^v1.3.0版本，解析依赖关系树并更新vendor/中的依赖关系。在示例应用程序上，因为dep已经选择了最新的可用版本1.3.0。但是，以后的更新（dep ensure -update）将不再跟踪主分支，而是使用semver标记的版本≥1.3.0和&lt;2.0.0。</p><p>dep主要使用Rust cargo类似的操作符来选择依赖的版本。这些包括\\^，～和=。还有一个更严格的，向前兼容的匹配比\\^使用～。例如，dep确保github.com/com/gorilla/mux@~1.2.0将匹配大于等于1.2.0和小于1.3.0任何版本。要锁定到特定版本，请使用=（e.x. dep ensure github.com/com/gorilla/mux@=1.2.0）。在未来，dep计划将\\^作为默认前缀。</p><h2 id="保持更新">保持更新</h2><p>要保持项目的依赖关系最新使用dep ensure -update，它将所有依赖关系更新为由manifest.json中的约束所允许的最新版本，并忽略lock.json的内容。 将新版本写入vendor/，并在lock.json中更新相应的元数据。<br>在将来，可以用dep ensure -update 更新单个依赖关系。</p><h2 id="status">Status</h2><p>当缺少依赖项时，dep status会告诉您哪些软件包缺失。 例如，这里是dep status的输出：</p><pre><code>$ dep status
PROJECT                 MISSING PACKAGES
github.com/boltdb/bolt  [github.com/boltdb/bolt]
</code></pre><p>如果项目的lock.json是最新的，dep status命令显示所有依赖项的列表，作为项目，并为每个：</p><ul><li><p>应用约束</p></li><li><p>选版本</p></li><li><p>所选修订版本</p></li><li><p>最新版本或修订版本</p></li><li><p>使用的软件包数量。<br>将bolt添加到示例项目并运行dep后，确保更新lock.json和vendor/，dep status如下所示：</p></li></ul><pre><code>$ dep status
PROJECT                     CONSTRAINT  VERSION        REVISION  LATEST   PKGS USED
github.com/boltdb/bolt      *           v1.3.0         583e893   v1.3.0   1
github.com/gorilla/context  *           v1.1           a85d2e5   v1.1     1
github.com/gorilla/mux      ^1.3.0      v1.3.0         392c28f   v1.3.0   1
golang.org/x/sys            *           branch master  7a6e564   7a6e564  1
</code></pre><p>这两种模式可以在将来合并。</p><h2 id="移除依赖">移除依赖</h2><p>dep remove删除manifest.json，lock.json和vendor/中的依赖关系。 使用示例应用程序，此提交从应用程序中删除github.com/gorilla/mux的使用，下一个提交是dep remove github.com/gorilla/mux的结果。 因为github.com/gorilla/mux被删除，github.com/gorilla/context不再需要，也会被删除。 如果在运行dep remove时仍然使用依赖关系，则命令将失败。 可以使用-force强制从manifest.json中删除约束。 但是，由于依赖项仍在使用中，它仍然在lock.json中并复制到vendor/。</p><h2 id="未来">未来</h2><p>dep仍然处于实验阶段，有许多问题需要解决和很多工作要做。 我希望这篇文章清楚地显示了一些如何使用工具的例子。 使用方式可能会随着时间的推移通过社区反馈和请求而改变。 如果你有一些空闲时间，并有兴趣参与一些Go工具开发，请现在开始。<br>谢谢阅读！</p></div><aside id="meta"><meta itemprop="wordCount" content="209"><meta itemprop="url" content="https://yushuangqi.com/blog/2017/gozui-xin-de-depxiang-jie.html"></aside></article><div><div class="attribution"><div class="bdsharebuttonbox"><a href="#" class="bds_more" data-cmd="more"></a><a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a><a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a><a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a><a href="#" class="bds_youdao" data-cmd="youdao" title="分享到有道云笔记"></a><a href="#" class="bds_mshare" data-cmd="mshare" title="分享到一键分享"></a></div><script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":["mshare","qzone","tsina","bdysc","weixin","tqq","tieba","douban","sqq","youdao","qingbiji","mail","evernotecn","copy","print"],"bdPic":"","bdStyle":"0","bdSize":"32"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script></div><div><ul class="rel_links"><li class="rel_linksli"><span id="topics">分类: <a href="/topics/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80%E4%B8%8E%E5%BC%80%E5%8F%91.html" rel="category">编程语言与开发</a> </span><span id="tags">标签: <a href="/tags/golang.html" rel="tag">golang</a></span></li><li class="rel_linksli rel_prev"><a href="https://yushuangqi.com/blog/2017/shu-ju-ku-bu-kuo-ge-dockerji-rong-qi-hua-de-7da-yuan-yin.html">数据库不适合Docker及容器化的7大原因</a></li><li class="rel_linksli rel_next"><a href="https://yushuangqi.com/blog/2017/you-xiu-de-go-cun-chu-kai-yuan-xiang-mu-he-ku.html">优秀的 Go存储开源项目和库</a></li></ul></div><aside id="comments"><div><div id="cyEmoji" role="cylabs" data-use="emoji" sid="e7400e3cf67b0ab09361d88de199d63e"></div><div id="cyReward" role="cylabs" data-use="reward" sid="e7400e3cf67b0ab09361d88de199d63e" style="text-align:center"></div><div id="SOHUCS" sid="e7400e3cf67b0ab09361d88de199d63e"></div><script type="text/javascript">(function(){ 
var appid = 'cyt7HM6Iq'; 
var conf = 'prod_90e85fc8b207249a2493340f99075c94'; 
var width = window.innerWidth || document.documentElement.clientWidth; 
if (width < 960) { 
window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id=' + appid + '&conf=' + conf + '"><\/script>'); 
}else{ 
  var loadJs=function(d,a){
    var c=document.getElementsByTagName("head")[0]||document.head||document.documentElement;var b=document.createElement("script");
    b.setAttribute("type","text/javascript");
    b.setAttribute("charset","UTF-8");
    b.setAttribute("src",d);
    if(typeof a==="function"){if(window.attachEvent){b.onreadystatechange=function(){var e=b.readyState;if(e==="loaded"||e==="complete"){b.onreadystatechange=null;a()}}}else{b.onload=a}}c.appendChild(b)};
   loadJs("https://changyan.sohu.com/upload/changyan.js",function(){window.changyan.api.config({appid:appid,conf:conf})}); } })();</script><script type="text/javascript" charset="utf-8" src="https://changyan.itc.cn/js/lib/jquery.js"></script><script type="text/javascript" charset="utf-8" src="https://changyan.sohu.com/js/changyan.labs.https.js?appid=cyt7HM6Iq"></script></div></aside></div></section><section id="sidebar" role="complementary"><aside class="writings"><a href="/" class="sideimg sideimgwritings">Home</a> <q class="dquote">读书之法，莫贵于循序而致精。<cite>—宋·朱熹《性理精义》</cite></q><ul class="rel_links"><li class="rel_linksli"><a href="http://weibo.com/234665601" title="关注虞双齐的微博" rel="nofollow">我的微博</a></li><li class="rel_linksli"><a href="https://github.com/ysqi" title="访问虞双齐的Github" rel="nofollow">我的 Github</a></li></ul></aside><aside><div class="ds-recent-comments" data-num-items="5" data-show-avatars="1" data-show-time="1" data-show-title="1" data-show-admin="1" data-excerpt-length="70"></div></aside></section><nav id="menu" role="navigation"><ul id="nav" class="navlist"><li class="navtop"><a class="navtoplink" href="#page"><span>Top</span></a></li><li><a class="navabout" href="https://yushuangqi.com"><span>首页</span></a></li><li><a class="navwritings" href="/topics/"><span>博文</span></a></li><li><a class="navpresos" href="/book.html"><span>电子书</span></a></li><li><a class="navabout" href="/about.html"><span>关于我</span></a></li></ul></nav></div><footer class="site-footer"><ul class="footeractions"><li><a class="footeraction" href="http://weibo.com/234665601" rel="nofollow" title="在微博关注 虞双齐"><span class="footeractionWeibo">Weibo</span></a></li><li><a class="footeraction" href="/index.xml" title="RSS订阅 虞双齐"><span class="footeractionRSS">Feed</span></a></li><li><a class="footeraction" href="http://validator.w3.org/check?uri=https%3a%2f%2fyushuangqi.com%2fblog%2f2017%2fgozui-xin-de-depxiang-jie.html" rel="nofollow" target="blank"><span class="footeractionW3CHTML">Valid XHTMl 4.0</span></a></li><li><a class="footeraction" href="http://jigsaw.w3.org/css-validator/validator?uri=https%3a%2f%2fyushuangqi.com%2fblog%2f2017%2fgozui-xin-de-depxiang-jie.html" rel="nofollow" target="blank"><span class="footeractionW3CCSS">Valid CSS Leval2</span></a></li></ul><p>©2015-2016 虞双齐-全栈开发。欢迎<a href="/about.html" rel="nofollow">联系我</a>，<a href="http://www.miitbeian.gov.cn/" target="bank" rel="nofollow" style="color:#c9c9c9">粤ICP备14032560号-4</a></p></footer><script>var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?a16b3275b071ec0efc507a05422a7156";
    var s = document.getElementsByTagName("script")[0]; 
    s.parentNode.insertBefore(hm, s);
  })();</script></body></html>