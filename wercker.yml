build:
  box: samueldebruyn/hugo-build
  steps:
    - script:
        name: initialize git submodules
        code: |
            git submodule update --init --recursive
    - arjen/hugo-build:
        prod_branches: master
        #dev_flags: --config=config-dev.toml
    - samueldebruyn/minify:
        only_on_branches: master
deploy:
  box: samueldebruyn/debian-git
  steps:
    - add-to-known_hosts:
        hostname: $BAIDU_GIT_HOST
    - script:
        name: Setup git repository
        code: |-
          cd public
          # Remove existing git repository if exists
          if [ -d ".git" ]; then rm -rf .git; fi
          # Configure git user
          git config --global user.name "wercker"
          git config --global user.email pleasemailus@wercker.com
          # Initialize new repository and add everything
          git init
          git add --all . > /dev/null
          if git diff --cached --exit-code --quiet; then
            echo "Nothing changed. We do not need to push"
          else
            git commit -am "DEPLOY FROM WERCKER" --allow-empty > /dev/null
          fi
          # Add baidu remote
          git remote add baidu $BAIDU_GIT_REMOTE
    - script:
        name: Git push deploy
        code: |-
          git push baidu master -f
